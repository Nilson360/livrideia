{% extends 'emails/base.html.twig' %}

{% block title %}ğŸ“– {{ sectionTitle|default('Vos recommandations personnalisÃ©es') }} - Livridea{% endblock %}

{% block content %}
    <div style="text-align: center; margin-bottom: 32px;">
        <div style="background: linear-gradient(135deg, #fef3e2, #fed7aa); padding: 8px 16px; border-radius: 20px; display: inline-block; margin-bottom: 16px;">
            <span style="color: #92400e; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">âœ¨ SpÃ©cialement pour vous</span>
        </div>
        <h2 style="color: #1f2937; margin: 0;">{{ sectionTitle|default('Recommandations personnalisÃ©es') }}</h2>
        <p style="color: #6b7280; margin: 8px 0 0 0;">BasÃ©es sur vos goÃ»ts et votre historique de lecture</p>
    </div>

    <p>Bonjour {{ user.fullName|default(user.username) }},</p>

    <p>Notre intelligence artificielle a analysÃ© vos prÃ©fÃ©rences, vos notes et vos lectures rÃ©centes pour vous proposer une sÃ©lection de livres parfaitement adaptÃ©s Ã  vos goÃ»ts. DÃ©couvrez ci-dessous vos recommandations de la semaine !</p>

    {% if user.favoriteGenres is defined and user.favoriteGenres|length > 0 %}
        <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 16px; margin: 24px 0; border-radius: 0 8px 8px 0;">
            <h3 style="color: #065f46; margin-bottom: 8px;">ğŸ¯ BasÃ© sur vos genres prÃ©fÃ©rÃ©s</h3>
            <p style="color: #065f46; margin: 0;">
                {% for genre in user.favoriteGenres %}
                    <span style="background: #dcfce7; padding: 2px 8px; border-radius: 12px; margin-right: 8px;">{{ genre }}</span>
                {% endfor %}
            </p>
        </div>
    {% endif %}

    <h3 style="color: #1f2937; margin: 32px 0 20px 0;">ğŸ“š Nos recommandations pour vous</h3>

    {% if books is defined and books|length > 0 %}
        {% for book in books %}
            <div class="book-card">
                <div class="book-cover">
                    {% if book.cover %}
                        <img src="{{ book.cover }}" alt="{{ book.title }}">
                    {% else %}
                        <div style="background: linear-gradient(135deg, #FF8A00, #e67300); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">ğŸ“–</div>
                    {% endif %}
                </div>
                <div class="book-info">
                    <h3>{{ book.title }}</h3>
                    <div class="author">{{ book.author }}</div>

                    {% if book.matchReason is defined %}
                        <div style="background: #eff6ff; color: #1e40af; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin: 8px 0; display: inline-block;">
                            ğŸ’¡ {{ book.matchReason }}
                        </div>
                    {% endif %}

                    <div class="description">{{ book.description|slice(0, 150) }}{% if book.description|length > 150 %}...{% endif %}</div>

                    {% if book.rating %}
                        <div style="margin: 12px 0;">
                            {% for i in 1..5 %}
                                <span style="color: {{ i <= book.rating ? '#F59E0B' : '#D1D5DB' }};">â­</span>
                            {% endfor %}
                            <span style="color: #6b7280; font-size: 14px; margin-left: 8px;">{{ book.rating }}/5 ({{ book.reviewsCount|default('23') }} avis)</span>
                        </div>
                    {% endif %}

                    {% if book.similarity is defined %}
                        <div style="background: #fef3e2; color: #92400e; padding: 8px; border-radius: 6px; margin-top: 12px; font-size: 14px;">
                            ğŸ”— <strong>{{ book.similarity }}% de correspondance</strong> avec vos goÃ»ts
                        </div>
                    {% endif %}

                    {% if book.price %}
                        <div style="margin-top: 12px;">
                            <span style="color: #1f2937; font-weight: 600; font-size: 16px;">{{ book.price }}â‚¬</span>
                        </div>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    {% else %}
        {# Recommandations d'exemple #}
        <div class="book-card">
            <div class="book-cover">
                <div style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">ğŸŒ™</div>
            </div>
            <div class="book-info">
                <h3>Les Chroniques de Lumina</h3>
                <div class="author">Ã‰lÃ©a Martineau</div>
                <div style="background: #eff6ff; color: #1e40af; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin: 8px 0; display: inline-block;">
                    ğŸ’¡ RecommandÃ© car vous avez aimÃ© "Le Seigneur des Anneaux"
                </div>
                <div class="description">Une fantasy Ã©pique qui mÃªle magie ancestrale et technologies futuristes. Suivez Anya dans sa quÃªte pour sauver son monde de l'obscuritÃ© Ã©ternelle.</div>
                <div style="margin: 12px 0;">
                    â­â­â­â­â­
                    <span style="color: #6b7280; font-size: 14px; margin-left: 8px;">4.7/5 (892 avis)</span>
                </div>
                <div style="background: #fef3e2; color: #92400e; padding: 8px; border-radius: 6px; margin-top: 12px; font-size: 14px;">
                    ğŸ”— <strong>94% de correspondance</strong> avec vos goÃ»ts
                </div>
            </div>
        </div>

        <div class="book-card">
            <div class="book-cover">
                <div style="background: linear-gradient(135deg, #ef4444, #dc2626); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">ğŸ”</div>
            </div>
            <div class="book-info">
                <h3>L'Ã‰nigme du Phare</h3>
                <div class="author">Marc Delacroix</div>
                <div style="background: #eff6ff; color: #1e40af; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin: 8px 0; display: inline-block;">
                    ğŸ’¡ Vous adorez les thrillers psychologiques
                </div>
                <div class="description">Un gardien de phare disparaÃ®t mystÃ©rieusement. Quand l'inspectrice Moreau arrive sur l'Ã®le, elle dÃ©couvre que rien n'est ce qu'il paraÃ®t...</div>
                <div style="margin: 12px 0;">
                    â­â­â­â­â˜†
                    <span style="color: #6b7280; font-size: 14px; margin-left: 8px;">4.3/5 (267 avis)</span>
                </div>
                <div style="background: #fef3e2; color: #92400e; padding: 8px; border-radius: 6px; margin-top: 12px; font-size: 14px;">
                    ğŸ”— <strong>89% de correspondance</strong> avec vos goÃ»ts
                </div>
            </div>
        </div>
    {% endif %}

    <div class="highlight-box">
        <h3>ğŸ¯ Pourquoi ces recommandations ?</h3>
        <p>Notre algorithme a analysÃ© :</p>
        <ul style="margin: 8px 0; padding-left: 20px;">
            <li>Vos {{ user.booksRead|default('47') }} livres lus et vos notes</li>
            <li>Vos {{ user.favoriteBooks|length|default('12') }} livres favoris</li>
            <li>Les genres que vous prÃ©fÃ©rez</li>
            <li>Les avis d'autres lecteurs aux goÃ»ts similaires</li>
        </ul>
    </div>

    <h3 style="color: #1f2937; margin: 32px 0 16px 0;">ğŸ”¥ Tendances dans vos genres prÃ©fÃ©rÃ©s</h3>

    <div style="background: #f9fafb; padding: 20px; border-radius: 12px; margin: 20px 0;">
        <h4 style="color: #1f2937; margin-bottom: 16px;">ğŸ“ˆ Ce qui cartonne en ce moment :</h4>
        <ul style="color: #4b5563; margin: 0; padding-left: 20px;">
            <li style="margin-bottom: 8px;"><strong>Fantasy urbaine :</strong> +34% de lectures ce mois</li>
            <li style="margin-bottom: 8px;"><strong>Romance contemporaine :</strong> +28% d'engouement</li>
            <li style="margin-bottom: 8px;"><strong>Thrillers psychologiques :</strong> +22% de popularitÃ©</li>
            <li style="margin-bottom: 8px;"><strong>Science-fiction climatique :</strong> Genre Ã©mergent</li>
        </ul>
    </div>

    {% if similarReaders is defined %}
        <div style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 20px; margin: 24px 0; border-radius: 0 8px 8px 0;">
            <h3 style="color: #1e40af; margin-bottom: 8px;">ğŸ‘¥ Lecteurs aux goÃ»ts similaires lisent aussi</h3>
            <p style="color: #1e40af; margin: 0;">{{ similarReaders|length }} lecteurs avec des prÃ©fÃ©rences proches des vÃ´tres ont Ã©galement adorÃ© ces livres.</p>
        </div>
    {% endif %}

    <div style="text-align: center; margin: 40px 0;">
        <a href="{{ booksUrl|default('#') }}" class="btn">DÃ©couvrir plus de recommandations</a>
        <div style="margin-top: 16px;">
            <a href="{{ quizUrl|default('#') }}" class="btn-secondary" style="margin-right: 16px;">Affiner mes goÃ»ts</a>
            <a href="{{ trendsUrl|default('#') }}" class="btn-secondary">Voir les tendances</a>
        </div>
    </div>

    <div class="stats">
        <div class="stat">
            <div class="stat-number">{{ recommendations.accuracy|default('92') }}%</div>
            <div class="stat-label">PrÃ©cision</div>
        </div>
        <div class="stat">
            <div class="stat-number">{{ user.booksRead|default('47') }}</div>
            <div class="stat-label">Livres analysÃ©s</div>
        </div>
        <div class="stat">
            <div class="stat-number">{{ recommendations.count|default('156') }}</div>
            <div class="stat-label">Recommandations</div>
        </div>
    </div>

    <div class="highlight-box">
        <h3>ğŸ’¡ AmÃ©liorez vos recommandations</h3>
        <p>Plus vous notez de livres et interagissez avec Livridea, plus nos suggestions deviennent prÃ©cises ! N'hÃ©sitez pas Ã  :</p>
        <ul style="margin: 8px 0; padding-left: 20px;">
            <li>Noter vos derniÃ¨res lectures</li>
            <li>Ajouter des livres Ã  vos favoris</li>
            <li>Indiquer vos genres prÃ©fÃ©rÃ©s dans vos paramÃ¨tres</li>
        </ul>
    </div>

    <p style="margin-top: 32px; font-style: italic; color: #6b7280;">
        Excellentes dÃ©couvertes !<br>
        L'Ã©quipe Livridea ğŸ“šâœ¨
    </p>
{% endblock %}